
#ifndef __SCHEDULER_H__
#define __SCHEDULER_H__

#include <stdbool.h>
#include <stdint.h>

//*****************************************************************************
#ifdef __cplusplus
extern "C"
{
#endif


typedef void (*tSchedulerFunction)(void);

//*****************************************************************************
//
//! Cấu trúc định nghĩa một hàm mà bộ lập lịch sẽ gọi định kỳ.
//
//*****************************************************************************
typedef struct
{
    //
    //! Con trỏ đến hàm sẽ được gọi định kỳ bởi bộ lập lịch.
    //
    void (*pfnFunction)();

    //
    //! Tần suất gọi hàm, được biểu diễn bằng số tick hệ thống.
    //! Nếu giá trị này là 0, hàm sẽ được gọi trong mỗi lần gọi SchedulerRun.
    //
    uint32_t ui32FrequencyTicks;

    //
    //! Thời điểm tick khi hàm này được gọi lần cuối. Trường này được cập nhật
    //! bởi bộ lập lịch.
    //
    uint32_t ui32LastCall;

    //
    //! Cờ chỉ định liệu tác vụ này có đang hoạt động hay không. Nếu true, hàm
    //! sẽ được gọi định kỳ. Nếu false, hàm bị vô hiệu hóa và sẽ không được gọi.
    //
    bool bActive;
}
tSchedulerTask;

//*****************************************************************************
//
//! Bảng toàn cục này phải được điền bởi client và chứa thông tin về
//! mỗi hàm mà bộ lập lịch sẽ gọi.
//
//*****************************************************************************
extern tSchedulerTask g_psSchedulerTable[];

//*****************************************************************************
//
//! Biến toàn cục này phải được xuất bởi client. Nó chứa số lượng mục
//! trong mảng g_psSchedulerTable.
//
//*****************************************************************************
extern uint32_t g_ui32SchedulerNumTasks;

//*****************************************************************************
//
// Đóng nhóm Doxygen.
//! @}
//
//*****************************************************************************

//*****************************************************************************
//
// Các nguyên mẫu hàm công khai
//
//*****************************************************************************
extern void SchedulerSysTickIntHandler(void);
extern void SchedulerInit(uint32_t ui32TicksPerSecond);
extern void SchedulerRun(void);
extern void SchedulerTaskEnable(uint32_t ui32Index, bool bRunNow);
extern void SchedulerTaskDisable(uint32_t ui32Index);
extern uint32_t SchedulerTickCountGet(void);
extern uint32_t SchedulerElapsedTicksGet(uint32_t ui32TickCount);
extern uint32_t SchedulerElapsedTicksCalc(uint32_t ui32TickStart,
                                               uint32_t ui32TickEnd);
extern uint32_t scheduler_get_tick();

//*****************************************************************************
//
// Đánh dấu phần kết thúc của liên kết C cho các trình biên dịch C++.
//
//*****************************************************************************
#ifdef __cplusplus
}
#endif

#endif // __ SCHEDULER_H_
